!function(e){"use strict";function t(e){function t(e){return r.setBaseImage(e[0]),r.setTargetImage(e[1]),n(r)}const r=g(e);return r?o(r).then(t)["catch"](p):Promise.reject("Failed to instantiate")}function n(e){function t(t,n){const a=e.getBaseImage(),i=e.getTargetImage(),o=a.width===i.width,c=a.height===i.height;if(!o||!c)return n("Image size mismatch");const g=a.data,s=i.data,m=g.length,d=new Uint8ClampedArray(m);for(var f,l,h,I,p,b,v,U=0;m>U;U+=4)f=U+0,l=U+1,h=U+2,I=U+3,p=Math.abs(g[f]-s[f]),b=Math.abs(g[l]-s[l]),v=Math.abs(g[h]-s[h]),d[f]=r(p,e),d[l]=r(b,e),d[h]=r(v,e),d[I]=255;const T=a.width,D=a.height,N=new w(d,T,D);return t(u(N,e))}return new Promise(t)}function r(e,t){var n=e;return n=i(n,t.getThreshold()),n=a(n,t.isNormalized())}function a(e,t){return t?e>0?255:0:e}function i(e,t){return e>t?e:0}function o(e){const t=e.getBaseImageUrl(),n=e.getTargetImageUrl(),r=e.getScale();return Promise.all([c(t,r),c(n,r)])}function c(e,t){function n(n,r){function a(){const a=o.width*t,i=o.height*t,c=document.createElement("canvas");c.width=a,c.height=i;const u=c.getContext("2d");u.drawImage(o,0,0,a,i);const g=u.getImageData(0,0,a,i);return d(g)?n(g):r("Failed to extract ImageData from `"+e+"`")}function i(){return r("Failed to load `"+e+"`")}const o=new Image;o.src=e,o.addEventListener("load",a,!1),o.addEventListener("error",i,!1)}return new Promise(n)}function u(e,t){function n(){return g.executionTime}function r(e){g.executionTime=new Date-e}function a(){const e=c(),n=e.width,r=e.height,a=document.createElement("canvas");a.width=n,a.height=r;const i=a.getContext("2d");i.putImageData(e,0,0);const o=new Image;o.src=a.toDataURL(),o.style.imageRendering="optimizespeed",o.style.imageRendering="pixelated",o.style.imageRendering="-webkit-optimize-contrast";const u=t.getScale();return o.width=Math.round(n/u),o.height=Math.round(r/u),o}function i(){const e=c(),t=o(),n=e.data.length/4,r=n/100;return t/r}function o(){const e=c(),t=e.data,n=t.length;for(var r,a,i,o=0,u=0;n>u;u+=4)r=u+0,a=u+1,i=u+2,(t[r]||t[a]||t[i])&&(o+=1);return o}function c(){return g.image}function u(e){return d(e)?(g.image=e,c()):p("No diff ImageData provided")}const g={},s={};return u(e)?(s.getImage=c,s.getPixels=o,s.getPercentage=i,s.producePreview=a,s.getExecutionTime=n,r(t.getTimestamp()),s):void 0}function g(e){function t(){return D.timestamp}function n(){D.timestamp=new Date}function r(){return D.targetImage}function a(e){return d(e)?(D.targetImage=e,r()):p("No targetImageData provided")}function i(){return D.baseImage}function o(e){return d(e)?(D.baseImage=e,i()):p("No baseImageData provided")}function c(){return D.targetImageUrl}function u(e){return l(e)?(D.targetImageUrl=e,c()):p("Failed to set targetImageUrl: `"+e+"`")}function g(){return D.baseImageUrl}function f(e){return l(e)?(D.baseImageUrl=e,g()):p("Failed to set baseImageUrl: `"+e+"`")}function I(){return D.threshold}function w(){return D.isNormalized}function b(e){D.isNormalized=!!e}function v(e){D.threshold=s(e)}function U(){return D.scale}function T(e){D.scale=m(e)}const D={},N={};return h(e)?f(e.baseImageUrl)&&u(e.targetImageUrl)?(n(),T(e.scale),v(e.threshold),b(e.isNormalized),N.getTargetImageUrl=c,N.getBaseImageUrl=g,N.getScale=U,N.getThreshold=I,N.setBaseImage=o,N.getBaseImage=i,N.setTargetImage=a,N.getTargetImage=r,N.isNormalized=w,N.getTimestamp=t,N):void 0:p("No parameters provided")}function s(e){const t=0,n=255;return f(e)?e>n?n:t>e?t:e:t}function m(e){const t=.01,n=1;return f(e)?e>n?n:t>e?t:e:n}function d(e){return"[object ImageData]"===I(e)}function f(e){return"[object Number]"===I(e)&&isFinite(e)}function l(e){return"[object String]"===I(e)&&e.length>0}function h(e){return"[object Object]"===I(e)}function I(e){return Object.prototype.toString.call(e)}function p(e){console.error("[canvas-compare]: "+e)}const w=e.ImageData;e.canvasCompare=t}(this);