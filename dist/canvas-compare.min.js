!function(t){"use strict";function e(t){function e(t){return r.setBaseImage(t[0]),r.setTargetImage(t[1]),n(r)}const r=g(t);return r?i(r).then(e)["catch"](p):Promise.reject("Failed to instantiate")}function n(t){function e(e,n){const a=t.getBaseImage(),o=t.getTargetImage(),i=a.width===o.width,u=a.height===o.height;if(!i||!u)return n("Image size mismatch");const g=a.data,s=o.data,m=g.length,d=new Uint8ClampedArray(m);for(var f,l,h,I,p,b,v,T=0;m>T;T+=4)f=T+0,l=T+1,h=T+2,I=T+3,p=Math.abs(g[f]-s[f]),b=Math.abs(g[l]-s[l]),v=Math.abs(g[h]-s[h]),d[f]=r(p,t),d[l]=r(b,t),d[h]=r(v,t),d[I]=255;const U=a.width,D=a.height,N=new w(d,U,D);return e(c(N,t))}return new Promise(e)}function r(t,e){var n=t;return n=o(n,e.getThreshold()),n=a(n,e.isNormalized())}function a(t,e){return e?t>0?255:0:t}function o(t,e){return t>e?t:0}function i(t){const e=t.getBaseImageUrl(),n=t.getTargetImageUrl(),r=t.getResolution();return Promise.all([u(e,r),u(n,r)])}function u(t,e){function n(n,r){function a(){const a=i.width*e,o=i.height*e,u=document.createElement("canvas");u.width=a,u.height=o;const c=u.getContext("2d");c.drawImage(i,0,0,a,o);const g=c.getImageData(0,0,a,o);return d(g)?n(g):r("Failed to extract ImageData from `"+t+"`")}function o(){return r("Failed to load `"+t+"`")}const i=new Image;i.src=t,i.addEventListener("load",a,!1),i.addEventListener("error",o,!1)}return new Promise(n)}function c(t,e){function n(){return g.executionTime}function r(t){g.executionTime=new Date-t}function a(){const t=u(),n=t.width,r=t.height,a=document.createElement("canvas");a.width=n,a.height=r;const o=a.getContext("2d");o.putImageData(t,0,0);const i=new Image;i.src=a.toDataURL(),i.style.cssText=["image-rendering: optimizespeed","image-rendering: pixelated"].join(";");const c=e.getResolution();return i.width=Math.round(n/c),i.height=Math.round(r/c),i}function o(){const t=u(),e=i(),n=t.data.length/4,r=n/100;return e/r}function i(){const t=u(),e=t.data,n=e.length;for(var r,a,o,i=0,c=0;n>c;c+=4)r=c+0,a=c+1,o=c+2,(e[r]||e[a]||e[o])&&(i+=1);return i}function u(){return g.image}function c(t){return d(t)?(g.image=t,u()):p("No diff ImageData provided")}const g={},s={};return c(t)?(s.getImage=u,s.getPixels=i,s.getPercentage=o,s.producePreview=a,s.getExecutionTime=n,r(e.getTimestamp()),s):void 0}function g(t){function e(){return D.timestamp}function n(){D.timestamp=new Date}function r(){return D.targetImage}function a(t){return d(t)?(D.targetImage=t,r()):p("No targetImageData provided")}function o(){return D.baseImage}function i(t){return d(t)?(D.baseImage=t,o()):p("No baseImageData provided")}function u(){return D.targetImageUrl}function c(t){return l(t)?(D.targetImageUrl=t,u()):p("Failed to set targetImageUrl: `"+t+"`")}function g(){return D.baseImageUrl}function f(t){return l(t)?(D.baseImageUrl=t,g()):p("Failed to set baseImageUrl: `"+t+"`")}function I(){return D.threshold}function w(){return D.isNormalized}function b(t){D.isNormalized=!!t}function v(t){D.threshold=s(t)}function T(){return D.resolution}function U(t){D.resolution=m(t)}const D={},N={};return h(t)?f(t.baseImageUrl)&&c(t.targetImageUrl)?(n(),U(t.resolution),v(t.threshold),b(t.isNormalized),N.getTargetImageUrl=u,N.getBaseImageUrl=g,N.getResolution=T,N.getThreshold=I,N.setBaseImage=i,N.getBaseImage=o,N.setTargetImage=a,N.getTargetImage=r,N.isNormalized=w,N.getTimestamp=e,N):void 0:p("No parameters provided")}function s(t){const e=0,n=255;return f(t)?t>n?n:e>t?e:t:e}function m(t){const e=.01,n=1;return f(t)?t>n?n:e>t?e:t:n}function d(t){return"[object ImageData]"===I(t)}function f(t){return"[object Number]"===I(t)&&isFinite(t)}function l(t){return"[object String]"===I(t)&&t.length>0}function h(t){return"[object Object]"===I(t)}function I(t){return Object.prototype.toString.call(t)}function p(t){console.error("[canvas-compare]: "+t)}const w=t.ImageData;t.canvasCompare=e}(this);