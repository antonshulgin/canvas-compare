!function(e){"use strict";function t(e){function t(e){return r.setBaseImage(e[0]),r.setTargetImage(e[1]),n(r)}const r=g(e);return r?i(r).then(t)["catch"](p):Promise.reject("Failed to instantiate")}function n(e){function t(t,n){const a=e.getBaseImage(),o=e.getTargetImage(),i=a.width===o.width,c=a.height===o.height;if(!i||!c)return n("Image size mismatch");const g=a.data,s=o.data,m=g.length,d=new Uint8ClampedArray(m);for(var f,l,h,I,p,b,v,T=0;m>T;T+=4)f=T+0,l=T+1,h=T+2,I=T+3,p=Math.abs(g[f]-s[f]),b=Math.abs(g[l]-s[l]),v=Math.abs(g[h]-s[h]),d[f]=r(p,e),d[l]=r(b,e),d[h]=r(v,e),d[I]=255;const U=a.width,D=a.height,N=new w(d,U,D);return t(u(N,e))}return new Promise(t)}function r(e,t){var n=e;return n=o(n,t.getThreshold()),n=a(n,t.isNormalized())}function a(e,t){return t?e>0?255:0:e}function o(e,t){return e>t?e:0}function i(e){const t=e.getBaseImageUrl(),n=e.getTargetImageUrl(),r=e.getScale();return Promise.all([c(t,r),c(n,r)])}function c(e,t){function n(n,r){function a(){const a=i.width*t,o=i.height*t,c=document.createElement("canvas");c.width=a,c.height=o;const u=c.getContext("2d");u.drawImage(i,0,0,a,o);const g=u.getImageData(0,0,a,o);return d(g)?n(g):r("Failed to extract ImageData from `"+e+"`")}function o(){return r("Failed to load `"+e+"`")}const i=new Image;i.src=e,i.addEventListener("load",a,!1),i.addEventListener("error",o,!1)}return new Promise(n)}function u(e,t){function n(){return g.executionTime}function r(e){g.executionTime=new Date-e}function a(){const e=c(),n=e.width,r=e.height,a=document.createElement("canvas");a.width=n,a.height=r;const o=a.getContext("2d");o.putImageData(e,0,0);const i=new Image;i.src=a.toDataURL(),i.style.cssText=["image-rendering: optimizespeed","image-rendering: pixelated"].join(";");const u=t.getScale();return i.width=Math.round(n/u),i.height=Math.round(r/u),i}function o(){const e=c(),t=i(),n=e.data.length/4,r=n/100;return t/r}function i(){const e=c(),t=e.data,n=t.length;for(var r,a,o,i=0,u=0;n>u;u+=4)r=u+0,a=u+1,o=u+2,(t[r]||t[a]||t[o])&&(i+=1);return i}function c(){return g.image}function u(e){return d(e)?(g.image=e,c()):p("No diff ImageData provided")}const g={},s={};return u(e)?(s.getImage=c,s.getPixels=i,s.getPercentage=o,s.producePreview=a,s.getExecutionTime=n,r(t.getTimestamp()),s):void 0}function g(e){function t(){return D.timestamp}function n(){D.timestamp=new Date}function r(){return D.targetImage}function a(e){return d(e)?(D.targetImage=e,r()):p("No targetImageData provided")}function o(){return D.baseImage}function i(e){return d(e)?(D.baseImage=e,o()):p("No baseImageData provided")}function c(){return D.targetImageUrl}function u(e){return l(e)?(D.targetImageUrl=e,c()):p("Failed to set targetImageUrl: `"+e+"`")}function g(){return D.baseImageUrl}function f(e){return l(e)?(D.baseImageUrl=e,g()):p("Failed to set baseImageUrl: `"+e+"`")}function I(){return D.threshold}function w(){return D.isNormalized}function b(e){D.isNormalized=!!e}function v(e){D.threshold=s(e)}function T(){return D.scale}function U(e){D.scale=m(e)}const D={},N={};return h(e)?f(e.baseImageUrl)&&u(e.targetImageUrl)?(n(),U(e.scale),v(e.threshold),b(e.isNormalized),N.getTargetImageUrl=c,N.getBaseImageUrl=g,N.getScale=T,N.getThreshold=I,N.setBaseImage=i,N.getBaseImage=o,N.setTargetImage=a,N.getTargetImage=r,N.isNormalized=w,N.getTimestamp=t,N):void 0:p("No parameters provided")}function s(e){const t=0,n=255;return f(e)?e>n?n:t>e?t:e:t}function m(e){const t=.01,n=1;return f(e)?e>n?n:t>e?t:e:n}function d(e){return"[object ImageData]"===I(e)}function f(e){return"[object Number]"===I(e)&&isFinite(e)}function l(e){return"[object String]"===I(e)&&e.length>0}function h(e){return"[object Object]"===I(e)}function I(e){return Object.prototype.toString.call(e)}function p(e){console.error("[canvas-compare]: "+e)}const w=e.ImageData;e.canvasCompare=t}(this);