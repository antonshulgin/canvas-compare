!function(t){"use strict";function e(t){function e(t){return r.setBaseImage(t[0]),r.setTargetImage(t[1]),n(r)}const r=g(t);return r?i(r).then(e)["catch"](p):Promise.reject("Failed to instantiate")}function n(t){function e(e,n){const a=t.getBaseImage(),o=t.getTargetImage(),i=a.width===o.width,c=a.height===o.height;if(!i||!c)return n("Image size mismatch");const g=a.data,s=o.data,m=g.length,d=new Uint8ClampedArray(m);for(var f,l,h,I,p,b,v,U=0;m>U;U+=4)f=U+0,l=U+1,h=U+2,I=U+3,p=Math.abs(g[f]-s[f]),b=Math.abs(g[l]-s[l]),v=Math.abs(g[h]-s[h]),d[f]=r(p,t),d[l]=r(b,t),d[h]=r(v,t),d[I]=255;const T=a.width,D=a.height,N=new w(d,T,D);return e(u(N,t))}return new Promise(e)}function r(t,e){var n=t;return n=o(n,e.getThreshold()),n=a(n,e.isNormalized())}function a(t,e){return e?t>0?255:0:t}function o(t,e){return t>e?t:0}function i(t){const e=t.getBaseImageUrl(),n=t.getTargetImageUrl(),r=t.getScale();return Promise.all([c(e,r),c(n,r)])}function c(t,e){function n(n,r){function a(){const a=i.width*e,o=i.height*e,c=document.createElement("canvas");c.width=a,c.height=o;const u=c.getContext("2d");u.drawImage(i,0,0,a,o);const g=u.getImageData(0,0,a,o);return d(g)?n(g):r("Failed to extract ImageData from `"+t+"`")}function o(){return r("Failed to load `"+t+"`")}const i=new Image;i.src=t,i.addEventListener("load",a,!1),i.addEventListener("error",o,!1)}return new Promise(n)}function u(t,e){function n(){return g.executionTime}function r(t){g.executionTime=new Date-t}function a(){const t=c(),n=t.width,r=t.height,a=document.createElement("canvas");a.width=n,a.height=r;const o=a.getContext("2d");o.putImageData(t,0,0);const i=new Image;i.src=a.toDataURL(),i.style.imageRendering="optimizespeed",i.style.imageRendering="-webkit-optimize-contrast";const u=e.getScale();return i.width=Math.round(n/u),i.height=Math.round(r/u),i}function o(){const t=c(),e=i(),n=t.data.length/4,r=n/100;return e/r}function i(){const t=c(),e=t.data,n=e.length;for(var r,a,o,i=0,u=0;n>u;u+=4)r=u+0,a=u+1,o=u+2,(e[r]||e[a]||e[o])&&(i+=1);return i}function c(){return g.image}function u(t){return d(t)?(g.image=t,c()):p("No diff ImageData provided")}const g={},s={};return u(t)?(s.getImage=c,s.getPixels=i,s.getPercentage=o,s.producePreview=a,s.getExecutionTime=n,r(e.getTimestamp()),s):void 0}function g(t){function e(){return D.timestamp}function n(){D.timestamp=new Date}function r(){return D.targetImage}function a(t){return d(t)?(D.targetImage=t,r()):p("No targetImageData provided")}function o(){return D.baseImage}function i(t){return d(t)?(D.baseImage=t,o()):p("No baseImageData provided")}function c(){return D.targetImageUrl}function u(t){return l(t)?(D.targetImageUrl=t,c()):p("Failed to set targetImageUrl: `"+t+"`")}function g(){return D.baseImageUrl}function f(t){return l(t)?(D.baseImageUrl=t,g()):p("Failed to set baseImageUrl: `"+t+"`")}function I(){return D.threshold}function w(){return D.isNormalized}function b(t){D.isNormalized=!!t}function v(t){D.threshold=s(t)}function U(){return D.scale}function T(t){D.scale=m(t)}const D={},N={};return h(t)?f(t.baseImageUrl)&&u(t.targetImageUrl)?(n(),T(t.scale),v(t.threshold),b(t.isNormalized),N.getTargetImageUrl=c,N.getBaseImageUrl=g,N.getScale=U,N.getThreshold=I,N.setBaseImage=i,N.getBaseImage=o,N.setTargetImage=a,N.getTargetImage=r,N.isNormalized=w,N.getTimestamp=e,N):void 0:p("No parameters provided")}function s(t){const e=0,n=255;return f(t)?t>n?n:e>t?e:t:e}function m(t){const e=.01,n=1;return f(t)?t>n?n:e>t?e:t:n}function d(t){return"[object ImageData]"===I(t)}function f(t){return"[object Number]"===I(t)&&isFinite(t)}function l(t){return"[object String]"===I(t)&&t.length>0}function h(t){return"[object Object]"===I(t)}function I(t){return Object.prototype.toString.call(t)}function p(t){console.error("[canvas-compare]: "+t)}const w=t.ImageData;t.canvasCompare=e}(this);